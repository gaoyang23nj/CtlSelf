\section{Introduction}
\label{sec:intro}
Opportunistic networks (OppNets)
have been proposed in the recent years,
and are usually exploited to provide the network/communication service
in the remote areas
or the emergency situations.
%describe the scenario,
%where the communication link may be
%established with contact opportunities
%among mobile nodes.
At present, with a widespread use and
availability of mobile communication devices,
OppNets presents very broad development prospect,
and numerous applications rely on it prospered.
\cite{DBLP:journals/tsc/KhalidKKZ14} builded a
cloud-based recommendation system OmniSuggest
based on opportunistic mobile social network.
In this project, user activities,
mobility patterns are tracked to
generate optimal venue recommendations.
The opportunistic computing technology utilize
the shared resources of OppNets to
provide a platform for the execution
of distributed computing tasks~\cite{DBLP:journals/tmc/ChatzopoulosAKH18}.
More examples can be found in mobile data offloading,
such as~\cite{DBLP:journals/tmc/HanHKMSS12,
DBLP:journals/tmc/LiQJHW014}.

Exploiting mobile nodes to transmit message in
OppNets has been attracting
increasing research attentions
\cite{DBLP:conf/sigcomm/SouzaMSMCC16,
DBLP:conf/mobicom/RadenkovicH17,
DBLP:journals/comsur/JedariXN18,
DBLP:journals/tmc/LoretiB20}.
Traditional message dissemination approaches
heavily rely on voluntary cooperation between
mobile nodes, which excessively consumes the
limited energy supply and lead to massive useless
message copies due to the selfish behavior.
Adopting selfish node detection mechanisms
to avoid selfish nodes involved in data forwarding,
reduces and balances the communication loads
of nodes (and thus their energy consumptions).
%However, selfish node detection leads to network
%management cost due to the detecting expense, and
%introduce extra detection traffic,
%degrading the overall performance of OppNets.

Much research effort on selfish node detection
exists in the literature. The state-of-the-art
detection schemes can be divided into two categories
in light of their aims:
watchdog systems~\cite{DBLP:conf/mobicom/MartiGLB00,
DBLP:journals/tmc/Hernandez-Orallo15,
DBLP:journals/tie/DiasRXM15,
DBLP:journals/fgcs/JedariXCDTA19}
and social trust-based communications
~\cite{DBLP:journals/tpds/ZhuDGDC14,
DBLP:journals/tdsc/ChoC18,
DBLP:journals/tmc/ChoiSLW12}.
The former intends to detect selfish behavior
by analyzing the traffic received
from their encountered nodes
while the latter establishes social trust relationships
to select trusted and secured relay nodes.
Most of the state-of-the-art work,
either watchdog system methods
or social trust-based communicating approaches,
are micro-perspective studies,
lead to network management cost
due to the detecting expense,
and introduce extra detection traffic,
degrading the overall performance of OppNets.

Incentive methods, i.e., reward,
are often exploited to attract the cooperations of nodes.
But the selfish nodes can pretend to carry the message
and gain the reward by cheating at the same time.
The detection can decrease the impact of selfish behaviors effectively.
However, the detection also introduces the detection cost,
including the computation cost and the communication cost.
In this paper, we exploit the Pontryagin's maximum principle to
minimize the weighted cost of the detection and the reward
based on the constructed message dissemination model.
%With a widespread use and availability of
%mobile communication devices, numerous applications
%emerge based on message transmission in OppNets,
%especially in mobile social networks (OMSNs).
%The opportunistic computing technology utilize
%the shared resources of OMSNs to
%provide a platform for the execution
%of distributed computing tasks,
The main contributions are as follows.

\begin{itemize}
\item {we formulate the ordinary differential equation model (ODE)
to capture and analytically evaluate the state transition of nodes
in OppNets without detection and with complete detection.}
\item {we propose an optimal solution of selfish node detection
based on the Pontryagin's maximum principle
to achieve the tradeoff between the detection cost
and the reward of selfish behaviors.}
\item {we conduct experiments to evaluate
the effectiveness of the proposed model
and the optimal selfish detection solution
in terms of the total cost, the wasted reward and the node state transition.}
\end{itemize}

The rest of this paper is organized as follows.
The literature is reviewed in Section~\ref{sec:related}.
We formulate the problem in Section~\ref{sec:preli}.
The change of network state without detection and with fully detection
is investigated in Section~\ref{sec:ode_model}.
The optimal solution of the selfish detection in OppNets
is presented in Section~\ref{sec:opt_detect},
and evaluated in Section~\ref{sec:pe}.
The paper concludes in Section~\ref{sec:conclude}.
